current_branch=$(git symbolic-ref --short HEAD 2>/dev/null || git describe --tags --exact-match 2>/dev/null || git rev-parse --short HEAD 2>/dev/null)

echo "Current branch: $current_branch"

case "$current_branch" in
    main|master|develop|staging)
        echo "Running full checks for protected branch..."
        
        echo "Type checking..."
        if ! pnpm run tslint; then
            echo "❌ Type checking failed!"
            exit 1
        fi
        
        echo "Running full code quality checks..."
        if ! pnpm run check; then
            echo "❌ Code quality checks failed!"
            exit 1
        fi
        
        echo "Building project..."
        if ! pnpm run build; then
            echo "❌ Build failed!"
            exit 1
        fi
        
        echo "✅ All pre-push checks passed for protected branch!"
        ;;
    *)
        echo "Feature branch detected - running lightweight checks..."
        
        if ! pnpm run tslint; then
            echo "❌ Type checking failed!"
            exit 1
        fi
        
        echo "✅ Lightweight checks passed for feature branch!"
        ;;
esac
